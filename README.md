# О чем проект

Проект посвящен решению задачи предсказания классификации цены телефона. Ссылка на исходную выборку: https://www.kaggle.com/datasets/iabhishekofficial/mobile-price-classification?resource=download

1) Настройка окружения и разведочный анализ данных. 

Подготовить структуру проекта и провести разведочный анализ данных. Результаты первой лабораторной работы будут использоваться в дальнейшем цикле работ.

2) Проведение экспериментов по настройке модели.

Провести ряд экспериментов по настройке модели, логируя все результаты в MLFlow. Научиться пользоваться инструментами autofeat, mlxtend, MLFlow


# Структура проекта:

IIS
```
 |_____ .venv (виртуальное окружение)
 |_____ .git
 |_____ data (исходные данные (.csv, .pkl))
 |_____ eda (артефакты, связанные с разведочным анализом данных)
    |___ MobilePrice_analysis.ipynb (блокнот с анализом данных)
    |___ .png - картинки, полученные в ходе анализа
 |_____ mlflow (содержиться все что связано с фреймворком mlflow, а также скрипт для запуска локального сервера)
    |___ start_mlflow.sh (bash-скрипт для запуска mlflow)
    |___ mlruns.db (БД)
 |_____ research (храниться артефакты по настройке модели)
    |___ model_settings.ipynb (блокнот с иследованием моделей)
    |___ main_features.txt (файл с названиями столбцов наиболее важных признаков)
    |___ new_features_cols.txt (файл с новыми признаками, полученных с помощью различных трансформаций из библиотеки sklearn)
    |___ all_models.jpg (Скриншот всех прогонов и их графиков с метриками качества)
    |___ register_model.jpg(Скриншот зарегистрированных версий моделей)
    |___ MLModel (файл MLModel для Production-модели)
 |_____ requirements.txt (файл с зависимостями)
 |_____ README.md (описание проекта)
```

# Как запустить проект

- клонирование репозитория по ssh
```
git clone git@github.com:VaninaAY/IIS.git
```
- клонирование репозитория по https
```
git clone https://github.com/VaninaAY/IIS.git 
```
- переход в папку
```
cd IIS
```
- создание виртуального окружение 
```
python -m venv .venv -
```
 - активация виртуального окружения
```
source .venv/bin/activate
```
- установка зависимостей
```
python -m pip install -r requirements.txt 
```

# Разведочный анализ данных

1) Исходные данные

Датафрейм содержит 2000 строк и 21 столбец. 14 столбцом имеют числовые признаки, 6 столбцов - категориальные, и 1 столбец с метками классов (целевая переменная price_range)

2) Очиска данных

   - Очистили нулевые значения для признаков - battery_power, clock_speed, int_memory,m_dep

   - Поставили минимальные значения для размера телефона - mobile_wt, px_height, px_width

   - Удалили строки для которых ширина телефона (sc_w) больше высоты (sc_h)

   - По итогам фильтрации осталось 1935 строк данных


3) Анализ данных 

   - Наибольший разброс значений наблюдается у ram, px_height, px_width, battery_power.

   - выбросы имеются у px_height, fc

   - признаки имеют разный маштаб
  
   - Наибольшая корреляция с целевой переменной (price_range) наблюдается у ram (0.92) (см. график ./eda/CorrelationHeatmap.png, ./eda/ram_vs_price.png)

   - Так же значимыми признаками являются px_height и px_width и была создана новая переменная total_pixels = px_height * px_width (./eda/new_features.png)

   - battery_power - отличаются медианные значения класса 0 и 3

   - m_dep - для класса 4 ящик больше чем у остальных классов

   - n_cores - медианное значение для класса 1 ниже чем для остальных классов

   - px_height - медианное значение классов 0,2 ниже чем для 1,3

   - px_width - для класса 0 медианные значения ниже класса 1 и 2. Для класса 3 медианное значение больше всего

   - talk_time - медианное значение для класса 1 больше чем для остальных

   - наблюдается четкая положительная линейная зависимость между высотой (px_height) и шириной (px_width) пикселей экрана


# Проведение экспериментов по настройке модели.
## Запуск MLFlow

Перейти в директорию mlflow и выполнить скрипт для запуска сервера:

```
cd mlflow
```

```
sh start_mlflow.sh
```

## Исследования

Сравнивали между собой модели:

1) Baseline-модель
2) Модель с новыми признаками, полученными с помощью трансформаций из библиотеки sklearn (PolynomialFeatures и KBinsDiscretizer)
3) Модель с наиболее важными признаками (полученные с помощью SequentialFeatureSelector)

Для лучшей модели из вышеперечисленных была выбрана наилучшая и для нее  подбирались гиперпараметры с помощью (GridSearchCV)

## Результаты исследования

Лучший результат до подбора гиперпараметров оказалась модель main_features (с отбором наиболее важных признаков). Метри для данной модели:

 * recall - 0.9090909090909091
 * precision - 0.9102642811116279
 * f1 - 0.9092405620419367


Выбранные столбцы - battery_power,px_width,ram,sc_w,total_pixels


Лучшими гиперпараметрами оказались:
 * max_depth=None
 * max_features=0.1
 * n_estimators=50

Метри для данной модели с подобранными гиперпараметрами стали чуть ниже:

* recall - 0.8698347107438017
* precision - 0.8712033323735907
* f1 - 0.8696873900589498


run_id Production модели:
```
d4a8f35ab134481cb800a7f5b7c627be
```


